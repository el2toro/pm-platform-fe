<div class="heading">
  <h1>{{ iSCreate ? "Create new Task" : "Edit Task" }}</h1>
</div>

<form [formGroup]="formGroup" class="form">
  <div class="form-field">
    <p-floatlabel>
      <input
        class="input-field"
        id="title"
        pInputText
        formControlName="title"
      />
      <label for="title">Task title</label>
    </p-floatlabel>
    <!-- @if (isInvalid('title')) {
    <p-message severity="error" size="small" variant="simple"
      >Task title is required.</p-message
    >
    } -->
  </div>

  <!-- <div class="form-field">
    <p-floatlabel>
      <textarea
        class="input-field"
        pTextarea
        id="description"
        formControlName="description"
      ></textarea>
      <label for="description">Description</label>
    </p-floatlabel>

     @if (isInvalid('description')) {
            @if (formGroup.get('description')?.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">Description is required.</p-message>
            }
            @if (formGroup.get('email')?.errors?.['email']) {
                <p-message severity="error" size="small" variant="simple">Please enter a valid email.</p-message>
            }
        } 
  </div> -->

  <div class="form-field">
    <p-floatlabel>
      <p-datepicker
        class="input-field"
        appendTo="body"
        [autofocus]="false"
        formControlName="dueDate"
      />
      <label for="dueDate">Task ends on...</label>
    </p-floatlabel>
  </div>

  @if(true){
  <div class="form-field">
    <p-floatlabel>
      <p-select
        [autofocus]="false"
        class="input-field"
        appendTo="body"
        [options]="taskStatuses"
        formControlName="taskStatus"
        optionLabel="name"
        optionValue="value"
      />
      <label for="taskStatus">Select task status</label>
    </p-floatlabel>
  </div>
  }
<!-- 
  @if (displaySubstask) {

  <div class="form-field">
    <p-floatlabel>
      <input
        class="input-field"
        id="subtaskTitle"
        pInputText
        formControlName="subtaskTitle"
      />
      <label for="subtaskTitle">Subtask title</label>
       <button (click)="addSubtask()">
        <i class="pi pi-plus"></i>
      </button>
    </p-floatlabel>
    <!-- @if (isInvalid('title')) {
    <p-message severity="error" size="small" variant="simple"
      >Task title is required.</p-message
    >
    } 
  </div>

   <div class="comment-list" style="display: grid;">
      @for (subtask of subtasks; track $index) {
        <span>{{subtask.title}}
          <button (click)="deleteSubtask(subtask)"><i class="pi pi-times"></i></button>
        </span>
      }
    </div>
  }


  <!-- @if (displayComment) {
  <div class="form-field">
    <p-floatlabel>
      <textarea
        class="input-field"
        id="commnet"
        pInputText
        formControlName="comment"
      ></textarea>
      <label for="subtaskTitle">Comment</label>
      <button (click)="addComment()">
        <i class="pi pi-plus"></i>
      </button>
    </p-floatlabel>
     @if (isInvalid('title')) {
    <p-message severity="error" size="small" variant="simple"
      >Task title is required.</p-message
    >
  } 
  </div> 

  [tableStyle]="{ 'min-width': '50rem' }"
  } -->

  <div class="card">
    <p-table [value]="iSCreate ? subtasks : task.subtasks" dataKey="id">
        <ng-template #header>
            <tr>
              @if (!iSCreate) {
                <th>Subtasks</th>
              }
               @if (iSCreate) {
                 <th>
                  <input pInputText type="text" placeholder="Subtask Title" formControlName="subtaskTitle" />
                </th>
                <th style="width: 4rem">
                  <button (click)="addSubtask()" pButton icon="pi pi-plus" class="p-button-rounded p-button-success"></button>
                </th>
               }
            </tr>
        </ng-template>

        <ng-template #body let-subtask let-editing="editing">
            <tr>
                <!-- Title Column -->
                <td [pEditableColumn]="subtask.title" pEditableColumnField="title">
                    <p-cellEditor>
                        <ng-template #input>
                            <input
                                formControlName="subtaskTitle"
                                pInputText
                                fluid 
                                [readOnly]="iSCreate"/>
                        </ng-template>
                        <ng-template #output>
                            {{ subtask.title }}
                        </ng-template>
                    </p-cellEditor>
                </td>
               @if (iSCreate) {
                <td>
                    <button (click)="deleteSubtask(subtask)" pButton icon="pi pi-times" class="p-button-rounded p-button-danger"></button>
                </td>
               }
            </tr>
        </ng-template>
    </p-table>
</div>


  <div class="actions">
    <button
      pButton
      label="Cancel"
      severity="secondary"
      (click)="onClose()"
    ></button>
    <button
      pButton
      label="{{ iSCreate ? 'Create' : 'Save' }}"
      (click)="onSaveOrCreate()"
    ></button>
  </div>
</form>
